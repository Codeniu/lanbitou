(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{373:function(s,t,n){"use strict";n.r(t);var a=n(42),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("yun install -y")]),s._v(" "),n("div",{staticClass:"language-dockerfile extra-class"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("############################################")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# version : Docker version1.10.3, build 3999ccb-unsupported")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# desc : 当前版本安装的ssh，wget，curl")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("############################################")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" docker.io/centos\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一次性安装vim，wget，curl，ssh server等必备软件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y vim wget curl openssh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server sudo\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /var/run/sshd\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装supervisor工具")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y Python"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("setuptools\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" easy_install supervisor\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /var/log/supervisor\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将sshd的UsePAM参数设置成no")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/UsePAM yes/UsePAM no/g'")]),s._v(" /etc/ssh/sshd_config\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ssh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keygen "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t rsa "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f /etc/ssh/ssh_host_rsa_key\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ssh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keygen "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t dsa "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f /etc/ssh/ssh_host_dsa_key\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加root账户的密码为123456")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root:123456"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" chpasswd\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加测试用户admin，密码admin，并且将此用户添加到sudoers里")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" useradd admin\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin:admin"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" chpasswd\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin  ALL=(ALL)      ALL"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /etc/sudoers\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 supervisord 的配置文件，并复制配置文件到对应目录下面。（supervisord.conf文件和Dockerfile文件在同一路径）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" supervisord.conf/etc/supervisor/supervisord.conf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器需要开放SSH 22端口")]),s._v("\nEXPOSE22\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行supervisord来同时执行多个命令，使用 supervisord 的可执行路径启动服务。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/supervisord"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])])]),n("p",[s._v("supervisord.conf文件")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 配置文件包含目录和进程\n# 第一段 supervsord 配置软件本身，使用 nodaemon 参数来运行。\n# 第二段包含要控制的 2 个服务。每一段包含一个服务的目录和启动这个服务的命令。\n\n[supervisord]\nnodaemon=true\n\n[program:sshd]\ncommand=/usr/sbin/sshd -D\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);
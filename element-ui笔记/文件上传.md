## 1通过组件action上传

效果：选中文件后上传到服务器

#### html

```html
            <!-- <el-upload
              class="avatar-uploader"
              :action="headerImgAction"
              :show-file-list="false"
              :on-success="handleAvatarSuccess"
              :before-upload="beforeAvatarUpload"
            >
              <img v-if="imageUrl" :src="imageUrl" class="avatar" style="width:100px;height:100px" />
              <i v-else class="el-icon-plus avatar-uploader-icon"></i>
            </el-upload>-->
```



#### js

```js
headerImgAction: "", //上传的地址
imageUrl: "",//用于显示上传后得图片
```

#### methods

```js

    //  头像上传相关
    handleAvatarSuccess(res, file) {
      this.imageUrl = URL.createObjectURL(file.raw);
    },
    
    //  图片上传前调用
    beforeAvatarUpload(file) {
      const isJPG = file.type === "image/jpeg";
      const isLt2M = file.size / 1024 / 1024 < 2;
      if (!isJPG) {
        this.$message.error("上传头像图片只能是 JPG 格式!");
      }
      if (!isLt2M) {
        this.$message.error("上传头像图片大小不能超过 2MB!");
      }
      return isJPG && isLt2M;
      var flag = false;
      if (this.addMsg.name == "" || this.addMsg.idCardNum == "") {
        this.$message.error("上传头像图片前请先填写基本信息");
      } else {
        flag = true;
        // 设置头像上传的action
        this.headerImgAction =
          "/coral-base/api/coral/base/archive/fileUpload/uploadHeadFile?daName=" +
          this.addMsg.name +
          "&idCardNum=" +
          this.addMsg.idCardNum;
      }
      return flag;
    },
```





## 2通过ajax请求上传文件

效果：选中文件后,通过读取文件转换为base64格式，在本地预览，在达到某个条件后通过ajax得post请求上传到服务器。

#### FormData()对象

```
let formdata = new FormData();
formdata.append("file", this.headFile);
```

#### 以post请求上传文件时报错	（Current request is not a multipart request）

```js
var header = { "Content-Type": "application/json;charset=utf-8" };
var header = { "Content-Type": "multipart/form-data;charset=utf-8" };
```

#### 请求	（文件对象参数必需包裹在form表单中，请求头也要改变）

```js
    // 上传头像 在新增人员成功后触发
    uploadHead() {
      let formdata = new FormData();
      formdata.append("file", this.headFile);
      var api =
        "/coral-base/api/coral/base/archive/fileUpload/uploadHeadFile?daName=" +
        this.addMsg.name +
        "&idCardNum=" +
        this.addMsg.idCardNum;
      var header = { "Content-Type": "multipart/form-data;charset=utf-8" };
      this.axios
        .post(api, formdata, header)
        .then(res => {
          if (res.data.success) {
            console.log("头像上传成功", res);
          } else {
            console.log(res);
          }
        })
        .catch(error => {
          console.log("上传头像时请求外部接口失败", error);
        });
    }
```








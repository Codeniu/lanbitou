### 文件上传

先贴代码：

html

```html
<label class="browse">
    upload
    <input
    id="file"
    class="sr-only"
    type="file"
    accept="image/*"
    multiple
    @change="getScanImgBase"
    />
</label>
```

js

```js

        getScanImgBase({ target }) {
            const URL = window.URL || window.webkitURL;

            let formdata = new FormData();
            var files = target.files;
            var blob = null;
            var forms = [formdata];

            if (!files || files.length === 0) {
                return;
            }
            let fileSize = 0;
            let count = 0;
            for (let i = 0; i < files.length; i++) {
                // 文件大小计算
                if (files[i].size > 0) {
                    fileSize += files[i].size;
                }
                // 文件大小超过300M。
                if (fileSize > 314572800) {
                    // if(fileSize > 3145728){
                    count++;
                    // 另起一个;
                    forms[count] = new FormData();
                    fileSize = files[i].size;
                }
                forms[count].append('fileFolder', files[i]);
            }
            // 调用请求
            this.synchronization_upload_scanda(
                this.orgTreeNodeData.idCardNum,
                forms,
            );
        },
            
            
        /**
         * 同步分批次上传上传图片
         */
        synchronization_upload_scanda(idCardNum, forms) {
            const loading = this.$loading({
                lock: true,
                text: '加载中,请稍后...',
                spinner: 'el-icon-loading',
                background: 'rgba(0, 0, 0, 0.7)',
            });
            if (forms !== null && forms.length > 0) {
                // 文件大小超过300M。
                if (forms.length > 1 && !this.isAlert_upload_message) {
                    this.isAlert_upload_message = true;
                    this.$message.warning(
                        '上传文件总大小超过300MB限制，将会分批上传！时间可能较长，请稍后！',
                    );
                }
                // shift()删除数组的第一个元素并返回
                this.load_localImages_to_scanda_post(idCardNum, forms.shift())
                    .then(data => {
                        // 上传成功 刷新列表
                        this.handle_refresh();
                        if (forms.length > 0) {
                            // 同步上传,回调,直到forms数组中已全部上传
                            this.synchronization_upload_scanda(
                                idCardNum,
                                forms,
                            );
                        } else {
                            this.isAlert_upload_message = false;
                            loading.close();
                        }
                    })
                    .catch(data => {
                        loading.close();
                        this.isAlert_upload_message = false;
                        let str = data.err + '\n' + data.message;
                        this.$message.error(str);
                    });
            } else {
                loading.close();
            }
        },
            
            
        /**
         * @description post请求
         * @param {idCardNum,array[file]}
         * */
        load_localImages_to_scanda_post(idCardNum, params) {
            let files = params.getAll('fileFolder');
            if (files === null || files.length === 0) {
                return;
            }
            let names = [];
            for (let i = 0; i < files.length; i++) {
                names.push(files[i].name);
            }
            return new Promise((resolve, reject) => {
                let api =
                    '/coral-base/api/coral/base/archive/fileUpload/uploadScanDaFiles?idCardNum=' +
                    idCardNum;
                params.append('fileNameList', names);
                let header = {
                    'Content-Type': 'multipart/form-data;charset=utf-8',
                };
                this.axios
                    .post(api, params, header)
                    .then(res => {
                        if (res.data.success) {
                            resolve();
                        } else {
                            reject({
                                message: '加载本地图片到扫描区:请求失败',
                                err: '检查状态码',
                            });
                        }
                    })
                    .catch(error => {
                        reject({ message: '捕获到异常', err: error });
                    });
            });
        },
```

